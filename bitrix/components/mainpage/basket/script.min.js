window.dataLayer=window.dataLayer||[];$(document).ready(function(){$("#basket_slider_left").owlCarousel({singleItem:true,autoPlay:false,mouseDrag:false,touchDrag:false,autoHeight:true});$("#paycheck_slider").owlCarousel({singleItem:true,autoPlay:false,mouseDrag:false,touchDrag:false});var c=$("#basket_slider_left").data("owlCarousel");var f=$("#paycheck_slider").data("owlCarousel");var a=[];$(".cl_items_prop").each(function(l,m){var n=$(this);var k={name:n.data("name"),id:n.data("product"),price:n.data("price"),brand:"",category:"",quantity:n.data("quantity")};a.push(k)});dataLayer.push({ecommerce:{currencyCode:"RUB",checkout:{actionField:{step:1},products:a}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Checkout Step 1","gtm-ee-event-non-interaction":"False"});$(".confirm_order_btn").click(function(){var k=1;c.jumpTo(k);f.jumpTo(k);g(k)});$(".input_basket").on("change keyup keypress focusout",function(){$.cookie("basket_"+$(this).attr("data-name"),$(this).val().trim(),{expires:30,path:"/"})});$(".input_basket").on("change",function(){$(this).removeClass("alert_element")});$(".btn_price_check").on("click",function(){items={};$.each($(".cl_items_prop"),function(k,l){items[$(this).data("product")]=$(this).data("price")});data_price_check={operation:"price_check",basket_id:$(".cl_items_prop").eq(0).data("id"),quantity:$(".cl_items_prop").eq(0).data("quantity"),products:items};$.post("/bitrix/components/mainpage/basket/ajax/",data_price_check,function(k){if(k==1){$("#reload_modal").modal("show")}})});$(".btn_check_price_reload").on("click",function(){location.reload()});data_order={};$(".phonenumber").mask("+7 (999) 999-99-99");$(".phone_confirm").click(function(){var m=2;var l={operation:"phone"};var k=$(this).parent().find(".form_input_basket").val().replace(/\+7 \(([0-9]{3})\) ([0-9]{3})\-([0-9]{2})\-([0-9]{2})/ig,"+7$1$2$3$4");if(k){data_order.phone=l.phone=k;if($.cookie("roistat_visit")){data_order.roistat_id=l.roistat_id=$.cookie("roistat_visit")}j(l,"not_reload");c.jumpTo(m);g(m)}else{$(this).parent().find(".error_wrap").html('<span class="error_message">Заполните поле '+$(this).parent().find(".input_basket").attr("placeholder")+"</span>");$(this).parent().find(".form_input_basket").addClass("alert_element")}dataLayer.push({ecommerce:{currencyCode:"RUB",checkout:{actionField:{step:m},products:a}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Checkout Step 2","gtm-ee-event-non-interaction":"False"})});$(".fio_confirm").click(function(){var o=3;confirm_flag=true;error_massage="";var n={operation:"fio",phone:data_order.phone};var k=$(".fullname_input");if(k.val()){data_order[k.data("name")]=n[k.data("name")]=k.val()}else{confirm_flag=false;k.addClass("alert_element");error_massage=error_massage+'<span class="error_message">Заполните поле '+k.attr("placeholder")+"</span>"}var l=$(".email_input");if(l.val()){var m=/^([a-z0-9_\.-])+@[a-z0-9-]+\.([a-z]{2,6}\.)?[a-z]{2,6}$/i;if(!m.test(l.val())){confirm_flag=false;l.addClass("alert_element");error_massage=error_massage+'<span class="error_message">Заполните правильно поле '+l.attr("placeholder").split(" ")[0]+"</span>"}else{data_order[l.data("name")]=n[l.data("name")]=l.val()}}$(this).parent().parent().find(".error_wrap").html(error_massage);if(confirm_flag==true){j(n,"not_reload");c.jumpTo(o);g(o)}dataLayer.push({ecommerce:{currencyCode:"RUB",checkout:{actionField:{step:o},products:a}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Checkout Step 3","gtm-ee-event-non-interaction":"False"})});$(".delivery_item").on("click",function(){$(".delivery_adress_block").show();$(".delivery_item").find(".check_elem_delivery").removeClass("delivery_check_elem_active");$(this).find(".check_elem_delivery").addClass("delivery_check_elem_active");$(".delivery_confirm").attr("data-delivery",$(this).data("delivery"));$(".delivery_confirm").attr("data-paysystem",$(this).data("paysystem"));if($(this).data("delivery")==2){$(".delivery_adress_block").hide()}});$(".delivery_confirm").on("click",function(){var k=true;var l=4;$(".paysystem_box").children().remove();data_order.delivery=$(this).attr("data-delivery");paysystem=$(this).attr("data-paysystem");if($(".delivery_adress_block").css("display")!="none"){if(!$(".adress_input").val()){k=false;$(".adress_input").addClass("alert_element")}}b(paysystem.split(","),arPaysystem);if(k==true){data_order.adress=$(".adress_input").val();c.jumpTo(l);g(l)}dataLayer.push({ecommerce:{currencyCode:"RUB",checkout:{actionField:{step:l},products:a}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Checkout Step 4","gtm-ee-event-non-interaction":"False"})});$(".paysystem_box").on("click",".paysystem_item",function(){$(".paysystem_item").find(".check_elem_paysystem").removeClass("paysystem_check_elem_active");$(this).find(".check_elem_paysystem").addClass("paysystem_check_elem_active");$(".paysystem_confirm").attr("data-paysystem",$(this).data("paysystem"));if($(this).data("paysystem")==16){$(".credit_line_first_btn").click()}dataLayer.push({ecommerce:{currencyCode:"RUB",checkout:{actionField:{step:"5"},products:a}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Checkout Step 5","gtm-ee-event-non-interaction":"False"})});$(".paysystem_confirm").on("click",function(){var k=5;data_order.operation="ordered";data_order.paysystem=$(this).attr("data-paysystem");data_order.discount_price=$(".order_discount_price").data("price");data_order.delivery_price=$(".order_delivery_price").data("price");data_order.summary_price=$(".order_summary_price").data("price");d();j(data_order,"not_reload","order");c.jumpTo(k);f.jumpTo(2);g(k)});$(".credit_line_first_btn").on("click",function(){c.jumpTo(6);f.jumpTo(1);g(4);dataLayer.push({ecommerce:{currencyCode:"RUB",checkout:{actionField:{step:6},products:a}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Checkout Step credit_line","gtm-ee-event-non-interaction":"False"})});$(".cl_range").on("change",function(){$(this).parent().find(".range_end_count").text($(this).val());var o=$(".cl_summ_base").val();var n=$(".cl_summ_in_month").val();var l=$("#cl_pay_first").val();var m=$("#cl_pay_month").val();var k=Math.ceil(o-(o*l*0.01));var n=Math.ceil((o-(o*l*0.01))/m);$(".cl_summ_total").val(k);$(".cl_summ_in_month").val(n)});$(".cl_main_phone").mask("+7 (999) 999-99-99");$(".cl_phone_dop").mask("+7 (999) 999-99-99");$(".cl_info_input").on("keyup",function(){$.cookie("basket_"+$(this).attr("data-name"),$(this).val().trim(),{expires:30,path:"/"})});$(".confirm_cl_btn").on("click",function(){var l=true;dataOne=[];$.each($(".cl_items_prop"),function(m,n){dataOne.push($(this).data())});var k={credit_line:{client:{},products:dataOne,payment:{duration:parseInt($("#cl_pay_month").val(),10),initial:Math.floor($(".cl_summ_base").val()*$("#cl_pay_first").val()*0.01),discount:14}}};$.each($(".validate_input"),function(m,o){if($(this).attr("type")=="checkbox"){if($(this).is(":checked")){}else{$(this).parent().find(".info_title").addClass("alert_element_color");$(".cl_error_block").show();l=false}}else{if(!$(this).val()){$(this).parent().find(".info_title").addClass("alert_element_color alert_element_right");$(this).addClass("alert_element");$(".cl_error_block").show();l=false}else{if($(this).attr("id")=="cl_mail"){var n=/^([a-z0-9_\.-])+@[a-z0-9-]+\.([a-z]{2,6}\.)?[a-z]{2,6}$/i;if(!n.test($(this).val())){l=false;$(this).parent().find(".info_title").addClass("alert_element_color alert_element_right");$(this).addClass("alert_element");$(".cl_error_block").show()}else{data_order[$(this).data("name")]=k.credit_line.client[$(this).data("name")]=$(this).val()}}else{if($(this).data("name")=="phone"){data_order[$(this).data("name")]=k.credit_line.client[$(this).data("name")]=$(this).val().replace(/\+7 \(([0-9]{3})\) ([0-9]{3})\-([0-9]{2})\-([0-9]{2})/ig,"+7$1$2$3$4")}else{data_order[$(this).data("name")]=k.credit_line.client[$(this).data("name")]=$(this).val().replace(/\+7 \(([0-9]{3})\) ([0-9]{3})\-([0-9]{2})\-([0-9]{2})/ig,"+7$1$2$3$4")}}}}});if($("#cl_phone_dop").val()){k.credit_line.client.extPhone=$("#cl_phone_dop").val().replace(/\+7 \(([0-9]{3})\) ([0-9]{3})\-([0-9]{2})\-([0-9]{2})/ig,"+7$1$2$3$4")}data_order.operation="cl-ordered";data_order.paysystem=16;data_order.delivery=3;if($.cookie("roistat_visit")){data_order.roistat_id=$.cookie("roistat_visit")}if($(".order_discount_price").data("price")){data_order.discount_price=$(".order_discount_price").data("price")}else{data_order.discount_price=0}data_order.delivery_price=$(".order_delivery_price").data("price");data_order.summary_price=$(".order_summary_price").data("price");k.credit_line.price=data_order.summary_price;if(l==true){d();$.post("/api/credit_line_gate/api/set_order/",k,function(m){if(m.status=="OK"){}},"json");j(data_order,"not_reload","order","cl",c,f)}});$(".validate_input").on("change",function(){$(this).parent().find(".info_title").removeClass("alert_element_color alert_element_right");$(this).removeClass("alert_element");$(".cl_error_block").hide()});$(".prev_slide").click(function(){h($(this).data("slide"));if($(this).data("check")==0){f.jumpTo($(this).data("check"))}c.prev();if($(this).data("cl")=="Y"){c.goTo(3)}});$(".form_input_basket").on("focus",function(){$(this).parent().parent().find(".error_wrap").html("");if($(this).attr("placeholder").indexOf("*")>0){var k=$(this).attr("placeholder").split("*");$(this).parent().find(".input_placeholder").html(k[0]+'<b class="red_star">*</b>')}else{$(this).parent().find(".input_placeholder").text($(this).attr("placeholder"))}});$(".form_input_basket").on("focusout",function(){if(!$(this).val()||$(this).val()=="+7 (___) ___-__-__"){$(this).parent().find(".input_placeholder").html("")}});$(".delete_product").on("click",function(){$(".gtm-product-id").val($(this).data("item_id"));var k={operation:"delete",id:$(this).data("item_id")};j(k);var l=$(this).parents(".basket_products_item");dataLayer.push({ecommerce:{currencyCode:"RUB",remove:{products:[{name:l.data("name"),id:l.data("product"),price:l.data("price"),brand:"",category:"",variant:"",quantity:l.data("quantity")}]}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Removing a Product from a Shopping Cart","gtm-ee-event-non-interaction":"False"})});$(".quantity_product_change").on("click",function(){var k={operation:$(this).data("operation"),id:$(this).data("item_id"),QUANTITY:$(this).data("count")};j(k)});if(screen.width>410){$(function(){$('[data-toggle="tooltip"]').tooltip({title:'В Вашей корзине есть товар, не доступный для приобретения в рассрочку. <a href="/content/credit_buy/" target="_blank">Подробнее</a>',placement:"top",trigger:"click hover"})})}else{$(function(){$('[data-toggle="tooltip"]').tooltip({title:'В Вашей корзине есть товар, не доступный для приобретения в рассрочку. <a href="/content/credit_buy/" target="_blank">Подробнее</a>',placement:"bottom",trigger:"click hover"})})}function j(p,o,k,m,n,l){if(o!="not_reload"){d()}$.post("/bitrix/components/mainpage/basket/ajax/",p,function(q){if(o!="not_reload"){location.reload()}if(k=="order"){$.each($(".client_info_wrap"),function(s){$(this).find(".client_info_value").text(p[$(this).data("content")])});var r=JSON.parse(q);$(".order_number").append(" "+r.order);$("#spiner_modal").modal("hide");$.get("https://node220.jivosite.com/widget/status/468678/HobMKhIZv9",function(s){var t=s.agents[0]["display_name"];$(".expert_name").text(t);$(".expert_foto img").attr("src","/bitrix/components/mainpage/basket/image/"+t+".png")});if(p.paysystem==14){window.open("/personal/order/payment/?ORDER_ID="+r.order);$(".order_payment_block").append('<span class="payment_info">Если окно с платежной информацией не открылось автоматически, нажмите </span> <a class="basket_btn orange_title" target="_blank" href="/personal/order/payment/?ORDER_ID='+r.order+'">Оплатить картой</a>')}if(m!="cl"){e(r.order)}else{n.jumpTo(5);l.jumpTo(3);g(5)}dataLayer.push({ecommerce:{currencyCode:"RUB",purchase:{actionField:{id:"m24_"+$.now()},products:a}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Purchase","gtm-ee-event-non-interaction":"False"})}})}function e(k){$.get("/api/new_basket_order/",{ORDER_ID:k})}function d(){$("#spiner_modal").modal("show")}function g(l){var k="#circle_"+l;$(k).addClass("active");for(i=1;i<l;i++){$("#circle_"+i).removeClass("active").addClass("done")}if(l==5){$(k).addClass("done")}}function h(m){var k="#circle_"+(m-1);var l="#circle_"+(m);$(k).removeClass("done").addClass("active");$(l).removeClass("active")}function b(o,k){var m="";var l=1;if(o){$(".paysystem_wrap").children().remove();var n={};$.each(o,function(p,q){if(k[q]){n[q]=k[q]}});k=n}$.each(k,function(p,q){if(l==1){check_pay=p;var r="paysystem_check_elem_active"}else{var r=""}m=m+'<div class="paysystem_item" data-paysystem="'+p+'" id="paysystem_id_'+p+'">            <div class="check_paysystem_item"><div class="check_elem_paysystem '+r+'"></div></div>            <div class="paysystem_info">                <div class="paysystem_name">'+q.NAME+'</div>                <div class="paysystem_description">'+q.DESCRIPTION+"</div>            </div>        </div>";l++});$(".paysystem_box").append(m);$(".paysystem_confirm").attr("data-paysystem",check_pay);dataLayer.push({ecommerce:{currencyCode:"RUB",checkout:{actionField:{step:"5"},products:a}},event:"gtm-ee-event","gtm-ee-event-category":"Enhanced Ecommerce","gtm-ee-event-action":"Checkout Step 5","gtm-ee-event-non-interaction":"False"})}});