$(document).ready(function(){if(window.location.pathname!="/"){var a=3500;$(".owl-carousel-map").owlCarousel({singleItem:true,mouseDrag:true,touchDrag:true,navigation:true,navigationText:["",""],pagination:true});var c=$(".catalog-detail").width();$("#map").width(c);$("#phonenumber_sms").mask("+7 (999) 999-99-99");$("#phonenumber_sms").on("keyup",function(){if($(this).val()[4]=="8"){$("#phonenumber_sms").mask("+7 (999) 999-99-99")}});$("#phonenumber_sms").change(function(){var e=$(this).val().replace(/\+7 \(([0-9]{3})\) ([0-9]{3})\-([0-9]{2})\-([0-9]{2})/ig,"$1$2$3$4");$("#phonenumber_format_sms").val(e)});var b=JSON.parse(shopsData);ymaps.ready(d);function d(){var e=b.map_marker;myMap=new ymaps.Map("map",{center:[e.yandex_lat,e.yandex_lon],zoom:e.yandex_scale,controls:["zoomControl","typeSelector","fullscreenControl","routeButtonControl"]});myMap.behaviors.disable("scrollZoom");if(b.shops){$.each(b.shops,function(f,h){var g=new ymaps.Placemark([h.LAT,h.LON],{iconContent:"",balloonContent:"",hintContent:h.NAME,ID:f},{preset:"islands#Icon",iconColor:"#9cc218"});myMap.geoObjects.add(g);g.events.add("click",function(i){var j=g.properties.get("ID");shop_active(j,b)})});$(".seeOnMap").on("click",function(){var f=$(this).data("shopid");shop_active(f,b);$("html,body").stop().animate({scrollTop:$("#where_to_buy").offset().top},1000)});if(screen.width>900){shop_active(0,b)}}}$(".close_btn").click(function(){$(".shop_contain").hide(700)});$(".shopAdressModal, .getAdressSms").on("click",function(){var e=$("#smsSendModal").find(".shopid").val();shop_active(e,b);$("#smsSendModal").find(".preview_block, .modal-footer").show();$("#smsSendModal").find(".end_block").html("");$("#smsSendModal").modal("show")});$("#smsSendModal").on("click",".getShopAdress",function(){$("#smsSendModal").find("#field_username").removeClass("error_attention");$("#smsSendModal").find("#phonenumber_sms").removeClass("error_attention");var i=$("#smsSendModal").find(".shopid").val();var g=$("#phonenumber_format_sms").val();var f=$("#field_username").val();var j=true;if(f.trim()==""||f.trim().length<=2){j=false;$("#smsSendModal").find("#field_username").addClass("error_attention")}if($("#phonenumber_format_sms").val().length!=10){j=false;console.log('$("#phonenumber_format_sms").val()',$("#phonenumber_format_sms").val().length);$("#smsSendModal").find("#phonenumber_sms").addClass("error_attention")}$(".form-control").on("keyup",function(){$(this).removeClass("error_attention")});if(j==true){$("#smsSendModal").find(".preview_block, .modal-footer").hide();$("#smsSendModal").find(".end_block").html('<img class="ajax_loader" src="/images/ajax-loader.gif" alt="">');var e={name:f,phone:g,city:b.CITY,shop_name:b.shops[i]["NAME"],adress:b.shops[i]["adress"]};if(b.product){var h=b.product;e.product=h.PRODUCT_NAME;e.productID=h.PRODUCT_ID;e.price=h.PRICE}$.post("/api/get_sms_adress/",e,function(l){var k="Ваша заявка принята.";var m="";if(l.error!=false){k=l.error;m='<div class="error_send">Заказать звонок</div>'}$("#smsSendModal").find(".preview_block").hide();$("#smsSendModal").find(".end_block").html("<span>"+k+"</span>"+m)},"json")}});$(".modal-body").on("click",".error_send",function(){$(".grcb_widget").click()})}});function shop_active(b,a){if(myMap.geoObjects.get(b)){myMap.geoObjects.each(function(c){c.options.set("preset","islands#Icon");c.options.set("iconColor","#9cc218")});$(".shop_contain").children().not(".close_btn").not(".shopAdressModal").not(".shopAdressModalContainer").remove();myMap.geoObjects.get(b).options.set("preset","islands#dotIcon");myMap.geoObjects.get(b).options.set("iconColor","darkgreen");shop_contain(b,a)}}function shop_contain(b,d){var a=d.shops[b];var c=$(".roistat_phone_value").text();if(!c){c="8&nbsp;800&nbsp;222&#8209;16&#8209;90"}$(".shop_contain").show(700);if(screen.width>425){$(".shop_contain").prepend('<div class=phoneShop><strong class="roistat_phone">'+c+"</strong></div>");$(".shop_contain").prepend("<div class=huomioShop><strong>Перед посещением</strong> шоу-рума, пожалуйста, <strong>свяжитесь с оператором</strong> для уточнения наличия по телефону:</div>");if(a.quarantine){$(".shop_contain").prepend("<div class=workTime>"+a.work_time+"</div>");$(".shop_contain").prepend('<div class=workTime><b style="color:red;">'+a.quarantine+":</div>")}else{$(".shop_contain").prepend('<div class=workTime><b style="color:red;">Магазин Закрыт.</b> Ожидаемая дата открытия 15 июля</div>')}}if(a.metro){$(".shop_contain").prepend("<div class=metroText>м."+a.metro+"</div>")}else{$(".shop_contain").prepend("<div class=metroText>"+a.city+"</div>")}$("#smsSendModal").find(".shopid").val(b)};